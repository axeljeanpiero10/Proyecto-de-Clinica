<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üîê Iniciar Sesi√≥n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0077b6, #00b4d8);
      display: flex; justify-content: center; align-items: center;
      padding: 1rem; min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      padding: 2rem;
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .logo {
      width: 80px;
      margin: 0 auto 1rem;
      display: block;
    }

    h1 {
      color: #0066cc;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    input, select {
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      text-align: center;
    }

    .error {
      color: red;
      font-size: 0.85rem;
      text-align: left;
      display: none;
    }

    button {
      padding: 0.75rem;
      background: #0078d7;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    button:hover {
      background: #005fa3;
    }

    .link {
      margin-top: 1rem;
      display: block;
      color: #0078d7;
      cursor: pointer;
      text-decoration: underline;
    }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 450px;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      overflow-y: auto;
      max-height: 90vh;
    }
    .modal-content h2 {
      margin-bottom: 1rem;
      color: #0077b6;
      font-size: 1.4rem;
      text-align: center;
    }

    
    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .btn-group button {
      flex: 1;
      padding: 0.75rem;
      font-size: 1rem;
    }
    .btn-cancel {
      background: #ccc;
      color: #333;
    }
    .btn-cancel:hover {
      background: #aaa;
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="img/logo.png" alt="Logo Cl√≠nica" class="logo">
    <h1>üîê Iniciar Sesi√≥n</h1>

    <form id="loginForm">
      <input type="text" id="usuario" placeholder="Usuario" required>
      <div class="error" id="err-user">Campo obligatorio</div>

      <input type="password" id="contrasena" placeholder="Contrase√±a" required>
      <div class="error" id="err-pass">Campo obligatorio</div>

      <select id="rol">
        <option value="paciente">Paciente</option>
        <option value="admin">Administrador</option>
      </select>

      <button type="submit">Ingresar</button>
    </form>

    <span class="link" onclick="abrirRegistro()">üìù Reg√≠strate como paciente</span>
  </div>

 
  <div class="modal" id="modalRegistro">
    <div class="modal-content">
      <h2>üë• Registro de Paciente</h2>
      <form id="registroForm">
        <input type="text" name="dni"              placeholder="DNI"               required>
        <input type="text" name="nombres"          placeholder="Nombres"           required>
        <input type="text" name="apellidos"        placeholder="Apellidos"         required>
        <input type="date" name="fecha_nacimiento" placeholder="Fecha de Nacimiento" required>
        <select name="sexo" required>
          <option value="" disabled selected>Sexo</option>
          <option value="M">M</option>
          <option value="F">F</option>
        </select>
        <input type="text" name="direccion"        placeholder="Direcci√≥n (opcional)">
        <input type="text" name="telefono"         placeholder="Tel√©fono"          required>
        <input type="email" name="correo"          placeholder="Correo"            required>
        <input type="password" name="contrasena"   placeholder="Contrase√±a"        required>

        <div class="btn-group">
          <button type="submit">Registrar</button>
          <button type="button" class="btn-cancel" onclick="cerrarRegistro()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Mostrar/Ocultar modal
    function abrirRegistro(){
      document.getElementById('modalRegistro').style.display = 'flex';
    }
    function cerrarRegistro(){
      document.getElementById('modalRegistro').style.display = 'none';
    }

    
    document.getElementById('registroForm').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const fd = new FormData(form);

      
      const fn = new Date(fd.get('fecha_nacimiento'));
      if (new Date().getFullYear() - fn.getFullYear() < 18) {
        return alert('‚õî Debes tener 18 a√±os o m√°s para registrarte.');
      }

      try {
        const res = await fetch('php/registrar_paciente.php', {
          method: 'POST',
          body: fd
        });
        const json = await res.json();
        if (json.success) {
          alert('‚úÖ Registro exitoso. Ya puedes iniciar sesi√≥n.');
          form.reset();
          cerrarRegistro();
        } else {
          alert('‚ùå ' + json.error);
        }
      } catch (err) {
        console.error(err);
        alert('‚ö†Ô∏è Error de comunicaci√≥n con el servidor.');
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      const u = document.getElementById('usuario').value.trim();
      const p = document.getElementById('contrasena').value.trim();
      const r = document.getElementById('rol').value;
      let valid = true;
      document.getElementById('err-user').style.display = u ? 'none' : 'block'   && (valid=false);
      document.getElementById('err-pass').style.display = p ? 'none' : 'block' && (valid=false);
      if (!valid) return;

      try {
        const res = await fetch('php/login.php', {
  method: 'POST',
  credentials: 'include',         
  headers: { 'Content-Type':'application/json' },
  body: JSON.stringify({ usuario: u, contrasena: p, rol: r })
});
        const data = await res.json();
        if (data.success) {
          // Se guardara el usuario en localStorage 
          localStorage.setItem('usuario', JSON.stringify({
            id_usuario: data.id_usuario,
            nombre: data.nombre,
            rol: data.rol
          }));
          // Se redirige seg√∫n el rol
          if (data.rol === 'admin') window.location.href = 'principal.html';
          else window.location.href = 'cita_paciente.html';
        } else {
          alert('‚ùå ' + data.error);
        }
      } catch (err) {
        console.error(err);
        alert('‚ö†Ô∏è Error de comunicaci√≥n con el servidor.');
      }
    });
  </script>
</body>
</html>





